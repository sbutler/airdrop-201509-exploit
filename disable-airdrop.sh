#!/bin/bash

dialog_ok() {
  osascript -e "tell app \"Finder\" to display dialog \"$1\" buttons { \"OK\" }"
}

dialog_cancelok() {
  osascript -e "tell app \"Finder\" to display dialog \"$1\" buttons { \"Cancel\", \"OK\" }"
}

 
airdrop_status() {
  local value=$(defaults read com.apple.NetworkBrowser DisableAirDrop)
  if [[ $? -eq 0 && $value == '1' ]]; then
    echo 'disabled'
  else
    echo 'enabled'
  fi
}

airdrop_disable() {
  defaults write com.apple.NetworkBrowser DisableAirDrop -bool YES

  # Check
  local status=$(airdrop_status)
  if [[ $status == 'disabled' ]]; then
    dialog_ok "AirDrop has been disabled."
  else
    dialog_ok "There was a problem disabling AirDrop."
  fi
}

airdrop_enable() {
  defaults delete com.apple.NetworkBrowser DisableAirDrop

  # Check
  local status=$(airdrop_status)
  if [[ $status == 'enabled' ]]; then
    dialog_ok "AirDrop has been enabled."
  else
    dialog_ok "There was a problem enabling AirDrop."
  fi
}


case `sw_vers -productVersion` in
  "10.11"*)
		status=$(airdrop_status)
		if [[ $status == 'enabled' ]]; then
			dialog_ok "Your version of OS X is not known to have a vulnerable AirDrop."
		else
			status=$(dialog_cancelok "Your version of OS X is not known to have a vulnerable AirDrop, but AirDrop is disabled. Click \\\"OK\\\" to enable it.")
			[[ $status == "button returned:OK" ]] && airdrop_enable
		fi
		;;

	*)
		airdrop_disable
		;;
esac
